# Звіт про тест навантаження сервера

## 1. Мета

Метою цього тесту було:

- Оцінити продуктивність сервера під типовим навантаженням.
- Визначити функції та блоки коду, які споживають найбільше ресурсів CPU.
- Проаналізувати використання RAM під час виконання основних сценаріїв.

## 2. Методологія

1. Підготовлено тест навантаження, який покриває основні сценарії використання сервісу:
   - Авторизація користувачів (`login`, `getMe`).
   - Робота з публікаціями (`getAll`, `getById`).
   - Хешування паролів (`bcryptjs`).
   - Генерація JWT токенів (`jsonwebtoken`).
   - Операції з MongoDB (`connection_pool`, `ensureMinPoolSize`).

2. Сервер запущено з профайлером V8 для збору статистики CPU та викликів функцій.

3. Запущено тест навантаження та зібрано дані профілювання.

## 3. Використання CPU

### 3.1 Розподіл за типами коду

| Тип коду         | Ticks | % від загальних tick | Коментар                                 |
| ---------------- | ----- | -------------------- | ---------------------------------------- |
| Shared libraries | 14653 | 91.8%                | Основне навантаження системних бібліотек |
| JavaScript       | 1010  | 6.3%                 | Виклики функцій Node.js та бібліотек     |
| GC               | 11    | 0.1%                 | Мінімальний вплив збирача сміття         |
| Unaccounted      | 304   | 1.9%                 | Невизначене використання CPU             |

### 3.2 Найважчі функції JavaScript

| Файл/Функція                                   | Ticks | % від JS | Коментар                                   |
| ---------------------------------------------- | ----- | -------- | ------------------------------------------ |
| `bcryptjs/_encipher`, `_hash`, `_async`        | 701   | 53.3%    | Хешування паролів                          |
| `bcryptjs/_key`                                | 246   | 35.1%    | Криптографічні операції                    |
| `mongodb/connection_pool.js:ensureMinPoolSize` | 72    | 5.5%     | Управління пулом з’єднань                  |
| `jsonwebtoken/sign.js`                         | 13    | 1.3%     | Генерація JWT                              |
| `auth.js:login`, `auth.js:getMe`               | 13    | 1.3%     | Логіка контролера авторизації              |
| Інші <1%                                       | 45    | 4.5%     | Допоміжні функції Node.js, Express, timers |

## 4. Використання пам’яті (RAM)

- Використання RAM залишалось стабільним під час тесту.
- Основна частина пам’яті була зайнята кешами Node.js та MongoDB.
- Сплесків використання пам’яті не зафіксовано.

## 5. Рекомендації

1. **Оптимізація хешування паролів:**
   - Використовувати асинхронні функції `bcryptjs` або `bcrypt`.
   - Зменшити `saltRounds`, якщо допустимо для частих операцій.

2. **MongoDB:**
   - Перевірити параметри пулу з’єднань (`minPoolSize`, `maxPoolSize`) для зменшення очікування.

3. **Додаткове профілювання:**
   - Профілювати сервер під реальною продуктивною навантаженістю для оцінки поведінки при високому трафіку.

## 6. Висновок

- Основним споживачем CPU є хешування паролів (`bcryptjs`).
- Робота з MongoDB та генерація JWT споживає помірну частку ресурсів.
- Сервер стабільно витримує типове навантаження без критичних сплесків RAM.
- Для підвищення продуктивності рекомендується оптимізація хешування та налаштування пулу MongoDB.
